name: Build Android App with Buildozer

on:
push:
branches:
- main
pull_request:
branches:
- main

jobs:
build:
runs-on: ubuntu-latest

steps:
- name: Checkout code
  uses: actions/checkout@v4

- name: Set up Python
  uses: actions/setup-python@v5
  with:
    python-version: '3.9'

- name: Install Python dependencies
  run: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt

- name: Cache Android SDK
  uses: actions/cache@v4
  with:
    path: ~/.buildozer
    key: ${{ runner.os }}-buildozer-${{ hashFiles('buildozer.spec') }}

- name: Install Buildozer and dependencies
  run: |
    pip install cython buildozer

- name: Build Android debug APK
  run: |
    buildozer -v android debug

- name: Upload APK as artifact
  uses: actions/upload-artifact@v4
  with:
    name: calculator-app-apk
    path: bin/*.apk
